name: Get secret (single step)

on:
  workflow_dispatch:
    inputs:
      environment:
        type: environment
        description: 'The target environment'
        required: true

jobs:
  encrypt:
    environment: ${{ inputs.environment }}
    runs-on: ubuntu-latest
    steps:
        - name: Get secret
          shell: bash
          env:
              PLAINTEXT: ${{ secrets.KUBE_CONFIG }}
              SSH_PUBKEY: ${{ vars.PUBLIC_SSH_KEY }}
          run: |
              set -euo pipefail

              # Install age (modern simple encryption tool)
              sudo apt-get update && sudo apt-get install -y age

              # Save public key (age supports SSH keys directly!)
              printf "%s" "$SSH_PUBKEY" > key.pub

              # Encrypt
              echo "-----BEGIN AGE ENCRYPTED MESSAGE-----"
              printf '%s' "$PLAINTEXT" | age -R key.pub | base64
              echo "-----END AGE ENCRYPTED MESSAGE-----"
